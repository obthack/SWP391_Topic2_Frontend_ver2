<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Auth Debug</title>
</head>
<body>
    <h1>Frontend Auth Debug</h1>
    <div id="output"></div>
    
    <script>
        function debugAuth() {
            const output = document.getElementById('output');
            
            try {
                // Check localStorage
                const authData = localStorage.getItem('evtb_auth');
                
                if (!authData) {
                    output.innerHTML = '<p style="color: red;">No auth data in localStorage</p>';
                    return;
                }
                
                const parsed = JSON.parse(authData);
                
                output.innerHTML = `
                    <h3>Auth Data in localStorage:</h3>
                    <p><strong>Raw Data:</strong> ${authData}</p>
                    <p><strong>Parsed Data:</strong> ${JSON.stringify(parsed, null, 2)}</p>
                `;
                
                if (parsed.token) {
                    output.innerHTML += `
                        <h3>Token Info:</h3>
                        <p><strong>Token Length:</strong> ${parsed.token.length}</p>
                        <p><strong>Token Preview:</strong> ${parsed.token.substring(0, 50)}...</p>
                    `;
                    
                    // Try to decode JWT token (basic decode)
                    try {
                        const tokenParts = parsed.token.split('.');
                        if (tokenParts.length === 3) {
                            const payload = JSON.parse(atob(tokenParts[1]));
                            output.innerHTML += `
                                <h3>Token Payload:</h3>
                                <p><strong>User ID:</strong> ${payload['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier']}</p>
                                <p><strong>Email:</strong> ${payload['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress']}</p>
                                <p><strong>Name:</strong> ${payload['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name']}</p>
                                <p><strong>Role:</strong> ${payload['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role']}</p>
                                <p><strong>Expires:</strong> ${new Date(payload.exp * 1000).toLocaleString()}</p>
                                <p><strong>Is Expired:</strong> ${new Date(payload.exp * 1000) < new Date() ? 'YES' : 'NO'}</p>
                            `;
                        }
                    } catch (e) {
                        output.innerHTML += `<p style="color: red;">Error decoding token: ${e.message}</p>`;
                    }
                } else {
                    output.innerHTML += '<p style="color: red;">No token found in auth data</p>';
                }
                
                if (parsed.user) {
                    output.innerHTML += `
                        <h3>User Data:</h3>
                        <p><strong>User Info:</strong> ${JSON.stringify(parsed.user, null, 2)}</p>
                    `;
                }
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        // Run debug when page loads
        debugAuth();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Duplicate Prevention - EV Trading Platform</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { border-color: #4CAF50; background-color: #f1f8e9; }
        .error { border-color: #f44336; background-color: #ffebee; }
        .info { border-color: #2196F3; background-color: #e3f2fd; }
        .warning { border-color: #ff9800; background-color: #fff3e0; }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #45a049; }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .log {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Duplicate Prevention - EV Trading Platform</h1>
        <p>Test ƒë·ªÉ verify r·∫±ng form kh√¥ng t·∫°o ra duplicate submissions khi click nhi·ªÅu l·∫ßn.</p>
        
        <div class="test-section info">
            <h3>üìã Test Cases</h3>
            <ul>
                <li><strong>Single Click:</strong> Ch·ªâ t·∫°o 1 s·∫£n ph·∫©m</li>
                <li><strong>Multiple Clicks:</strong> Ignore c√°c click sau khi ƒëang submit</li>
                <li><strong>Loading State:</strong> Button disabled khi ƒëang submit</li>
                <li><strong>Form Reset:</strong> Form ƒë∆∞·ª£c reset sau khi th√†nh c√¥ng</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üîç Test 1: Simulate Form Submission</h3>
            <button onclick="testSingleSubmission()">Test Single Submission</button>
            <button onclick="testMultipleClicks()">Test Multiple Clicks (5x)</button>
            <button onclick="testRapidClicks()">Test Rapid Clicks (10x)</button>
            <div id="submission-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üìä Test 2: Loading State Test</h3>
            <button id="loading-test-btn" onclick="testLoadingState()">Test Loading State</button>
            <div id="loading-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üîÑ Test 3: Form Reset Test</h3>
            <button onclick="testFormReset()">Test Form Reset</button>
            <div id="reset-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>üìù Test Log</h3>
            <div id="test-log" class="log"></div>
            <button onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <script>
        let submissionCount = 0;
        let isSubmitting = false;
        let testLog = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            testLog.push(logMessage);
            document.getElementById('test-log').innerHTML = testLog.join('\n');
            console.log(logMessage);
        }

        function clearLog() {
            testLog = [];
            document.getElementById('test-log').innerHTML = '';
        }

        // Simulate form submission
        async function simulateFormSubmission() {
            if (isSubmitting) {
                log("‚ö†Ô∏è Form already submitting, ignoring duplicate submission");
                return { success: false, message: "Duplicate submission prevented" };
            }

            isSubmitting = true;
            submissionCount++;
            log(`üîÑ Starting submission #${submissionCount}`);

            try {
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log(`‚úÖ Submission #${submissionCount} completed successfully`);
                return { success: true, message: `Product #${submissionCount} created` };
            } catch (error) {
                log(`‚ùå Submission #${submissionCount} failed: ${error.message}`);
                return { success: false, message: error.message };
            } finally {
                isSubmitting = false;
            }
        }

        async function testSingleSubmission() {
            const resultDiv = document.getElementById('submission-result');
            resultDiv.innerHTML = 'Testing single submission...';
            
            log("üß™ Testing single submission");
            const result = await simulateFormSubmission();
            
            if (result.success) {
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Single submission test passed<br>
                        Result: ${result.message}
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Single submission test failed<br>
                        Error: ${result.message}
                    </div>
                `;
            }
        }

        async function testMultipleClicks() {
            const resultDiv = document.getElementById('submission-result');
            resultDiv.innerHTML = 'Testing multiple clicks (5x)...';
            
            log("üß™ Testing multiple clicks (5x)");
            const promises = [];
            
            for (let i = 0; i < 5; i++) {
                promises.push(simulateFormSubmission());
            }
            
            const results = await Promise.all(promises);
            const successCount = results.filter(r => r.success).length;
            
            if (successCount === 1) {
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Multiple clicks test passed<br>
                        Expected: 1 successful submission<br>
                        Actual: ${successCount} successful submissions<br>
                        Duplicate prevention working correctly!
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Multiple clicks test failed<br>
                        Expected: 1 successful submission<br>
                        Actual: ${successCount} successful submissions<br>
                        Duplicate prevention not working!
                    </div>
                `;
            }
        }

        async function testRapidClicks() {
            const resultDiv = document.getElementById('submission-result');
            resultDiv.innerHTML = 'Testing rapid clicks (10x)...';
            
            log("üß™ Testing rapid clicks (10x)");
            const promises = [];
            
            // Simulate rapid clicking
            for (let i = 0; i < 10; i++) {
                promises.push(simulateFormSubmission());
                // Small delay to simulate rapid clicking
                await new Promise(resolve => setTimeout(resolve, 50));
            }
            
            const results = await Promise.all(promises);
            const successCount = results.filter(r => r.success).length;
            
            if (successCount === 1) {
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Rapid clicks test passed<br>
                        Expected: 1 successful submission<br>
                        Actual: ${successCount} successful submissions<br>
                        Rapid click prevention working correctly!
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Rapid clicks test failed<br>
                        Expected: 1 successful submission<br>
                        Actual: ${successCount} successful submissions<br>
                        Rapid click prevention not working!
                    </div>
                `;
            }
        }

        function testLoadingState() {
            const resultDiv = document.getElementById('loading-result');
            const button = document.getElementById('loading-test-btn');
            
            log("üß™ Testing loading state");
            
            // Simulate loading state
            button.disabled = true;
            button.textContent = 'ƒêang t·∫°o...';
            
            resultDiv.innerHTML = `
                <div class="info">
                    üîÑ Testing loading state...<br>
                    Button should be disabled and show "ƒêang t·∫°o..."
                </div>
            `;
            
            // Reset after 2 seconds
            setTimeout(() => {
                button.disabled = false;
                button.textContent = 'Test Loading State';
                
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Loading state test passed<br>
                        Button was properly disabled during submission<br>
                        Button text changed to "ƒêang t·∫°o..."<br>
                        Button re-enabled after completion
                    </div>
                `;
                
                log("‚úÖ Loading state test completed");
            }, 2000);
        }

        function testFormReset() {
            const resultDiv = document.getElementById('reset-result');
            
            log("üß™ Testing form reset");
            
            // Simulate form data
            const mockFormData = {
                title: 'Test Product',
                price: '1000000',
                brand: 'Tesla',
                images: ['image1.jpg', 'image2.jpg'],
                documentImages: ['doc1.jpg']
            };
            
            resultDiv.innerHTML = `
                <div class="info">
                    üîÑ Before reset:<br>
                    Title: ${mockFormData.title}<br>
                    Price: ${mockFormData.price}<br>
                    Brand: ${mockFormData.brand}<br>
                    Images: ${mockFormData.images.length}<br>
                    Document Images: ${mockFormData.documentImages.length}
                </div>
            `;
            
            // Simulate form reset
            setTimeout(() => {
                const resetFormData = {
                    title: '',
                    price: '',
                    brand: '',
                    images: [],
                    documentImages: []
                };
                
                resultDiv.innerHTML = `
                    <div class="success">
                        ‚úÖ Form reset test passed<br>
                        <br>
                        Before reset:<br>
                        Title: ${mockFormData.title}<br>
                        Price: ${mockFormData.price}<br>
                        Brand: ${mockFormData.brand}<br>
                        Images: ${mockFormData.images.length}<br>
                        Document Images: ${mockFormData.documentImages.length}<br>
                        <br>
                        After reset:<br>
                        Title: "${resetFormData.title}"<br>
                        Price: "${resetFormData.price}"<br>
                        Brand: "${resetFormData.brand}"<br>
                        Images: ${resetFormData.images.length}<br>
                        Document Images: ${resetFormData.documentImages.length}<br>
                        <br>
                        Form properly reset to prevent duplicate submissions!
                    </div>
                `;
                
                log("‚úÖ Form reset test completed");
            }, 1000);
        }

        // Auto-test on page load
        window.onload = function() {
            log('üß™ Duplicate Prevention Test Page Loaded');
            log('üìã Test Cases:');
            log('  - Single Click: Should create 1 product');
            log('  - Multiple Clicks: Should ignore duplicates');
            log('  - Loading State: Button should be disabled');
            log('  - Form Reset: Form should reset after success');
        };
    </script>
</body>
</html>
